<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>F1 Endless Racer</title>
<style>
  body {
    margin: 0;
    background: #000;
    font-family: Arial, sans-serif;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    color: white;
  }
  canvas {
    background: skyblue;
    border: 4px solid white;
  }
</style>
</head>
<body>

<canvas id="game" width="900" height="500"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

const TRACK_LENGTH = 10000; // 10 km
let raceStarted = false;
let raceOver = false;
let countdown = 180; // frames (3 seconds)
let finishOrder = [];

// ---------------- INPUT ----------------
const keys = {};
document.addEventListener("keydown", e => keys[e.key] = true);
document.addEventListener("keyup", e => keys[e.key] = false);

// ---------------- ROAD ----------------
let roadOffset = 0;
let roadCurve = 0;
let curveDir = 0;

// ---------------- PLAYER ----------------
const player = {
  x: 0,
  speed: 0,
  maxSpeed: 7,
  dist: 0,
  vx: 0
};

// ---------------- AI CARS ----------------
const aiCars = [];
for (let i = 0; i < 4; i++) {
  aiCars.push({
    lane: (i - 1.5) * 120,
    dist: Math.random() * 300,
    speed: 4.5 + Math.random(),
    color: ["blue", "green", "yellow", "orange"][i]
  });
}

// ---------------- UPDATE ----------------
function update() {
  if (raceOver) return;

  // Countdown
  if (!raceStarted) {
    countdown--;
    if (countdown <= 0) raceStarted = true;
    return;
  }

  // PLAYER SPEED
  if (keys["ArrowUp"]) player.speed += 0.15;
  if (keys["ArrowDown"]) player.speed -= 0.25;
  player.speed *= 0.985;
  player.speed = Math.max(0, Math.min(player.speed, player.maxSpeed));

  // DRIFT
  const drifting = keys[" "];
  const grip = drifting ? 0.92 : 0.75;
  const steerPower = drifting ? 0.6 : 0.4;

  if (keys["ArrowLeft"]) player.vx -= steerPower;
  if (keys["ArrowRight"]) player.vx += steerPower;

  player.vx *= grip;
  player.x += player.vx;

  // ROAD CURVES
  if (Math.random() < 0.01) {
    curveDir = (Math.random() - 0.5) * 2;
  }
  roadCurve += curveDir * 0.002;
  roadCurve *= 0.98;
  player.x -= roadCurve * player.speed * 15;

  // LIMITS
  player.x = Math.max(-220, Math.min(220, player.x));

  // DISTANCE
  player.dist += player.speed;
  roadOffset += player.speed;

  // AI
  aiCars.forEach(ai => {
    ai.dist += ai.speed;
    ai.lane += roadCurve * 8;
  });

  // FINISH
  if (player.dist >= TRACK_LENGTH) {
    finishOrder.push("YOU");
    raceOver = true;
  }
}

// ---------------- DRAW ----------------
function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // ROAD
  ctx.fillStyle = "#555";
  ctx.beginPath();
  ctx.moveTo(200 + roadCurve * 300, 500);
  ctx.lineTo(350 + roadCurve * 100, 200);
  ctx.lineTo(550 + roadCurve * 100, 200);
  ctx.lineTo(700 + roadCurve * 300, 500);
  ctx.closePath();
  ctx.fill();

  // LANE LINES
  ctx.strokeStyle = "white";
  ctx.setLineDash([20, 20]);
  for (let i = -1; i <= 1; i++) {
    ctx.beginPath();
    ctx.moveTo(450 + i * 120 + roadCurve * 200, 500);
    ctx.lineTo(450 + i * 40 + roadCurve * 80, 200);
    ctx.stroke();
  }
  ctx.setLineDash([]);

  // AI CARS
  aiCars.forEach(ai => {
    const z = ai.dist - player.dist;
    if (z < -50 || z > 800) return;

    const scale = 1 - z / 1000;
    const x = 450 + ai.lane * scale + roadCurve * z * 0.5;
    const y = 300 + z * 0.4;

    ctx.fillStyle = ai.color;
    ctx.fillRect(x - 20 * scale, y - 10 * scale, 40 * scale, 20 * scale);
  });

  // PLAYER CAR
  ctx.save();
  ctx.translate(450 + player.x, 420);
  ctx.rotate(player.vx * 0.03);
  ctx.fillStyle = "red";
  ctx.fillRect(-25, -12, 50, 24);
  ctx.restore();

  // HUD
  ctx.fillStyle = "white";
  ctx.font = "18px Arial";
  ctx.fillText(`Distance: ${Math.floor(player.dist)} / ${TRACK_LENGTH} m`, 20, 30);
  ctx.fillText("SPACE = Drift", 20, 55);

  // COUNTDOWN
  if (!raceStarted) {
    ctx.font = "80px Arial";
    ctx.fillStyle = "white";
    const text = countdown > 120 ? "3" : countdown > 60 ? "2" : "1";
    ctx.fillText(text, 430, 250);
  }

  // FINISH
  if (raceOver) {
    ctx.fillStyle = "black";
    ctx.fillRect(200, 150, 520, 200);
    ctx.fillStyle = "white";
    ctx.font = "30px Arial";
    ctx.fillText("YOU FINISHED THE RACE!", 260, 220);
    ctx.font = "28px Arial";
    ctx.fillText("ðŸŽ‰ HAPPY NEW YEAR 2026!!! ðŸŽ‰", 245, 270);
  }
}

// ---------------- LOOP ----------------
function loop() {
  update();
  draw();
  requestAnimationFrame(loop);
}

loop();
</script>

</body>
</html>
