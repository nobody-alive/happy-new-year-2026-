<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Ultimate F1 Racer</title>
<style>
body {
  margin: 0;
  background: black;
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
  color: white;
  font-family: Arial;
}
canvas {
  border: 4px solid white;
  background: #87ceeb;
}
</style>
</head>
<body>

<canvas id="game" width="900" height="500"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

// ================= CONSTANTS =================
const TRACK_LENGTH = 12000;
const BASE_MAX_SPEED = 8;

// ================= STATE =================
let raceStarted = false;
let raceOver = false;
let countdown = 180;
let roadCurve = 0;
let targetCurve = 0;
let rain = Math.random() < 0.5;
let night = true;

// ================= INPUT =================
const keys = {};
document.addEventListener("keydown", e => keys[e.key] = true);
document.addEventListener("keyup", e => keys[e.key] = false);

// ================= PLAYER =================
const player = {
  x: 0,
  vx: 0,
  speed: 0,
  dist: 0,
  angle: 0,
  tire: 100,
  damage: 0,
  drs: false,
  inPit: false
};

// ================= AI =================
const aiCars = [];
for (let i = 0; i < 4; i++) {
  aiCars.push({
    name: "AI " + (i + 1),
    lane: (i - 1.5) * 140,
    dist: Math.random() * 600,
    speed: 4.5 + Math.random(),
    color: ["blue", "green", "yellow", "orange"][i]
  });
}

// ================= UPDATE =================
function update() {
  if (raceOver) return;

  // Countdown
  if (!raceStarted) {
    countdown--;
    if (countdown <= 0) raceStarted = true;
    return;
  }

  // Road curves
  if (Math.random() < 0.01)
    targetCurve = (Math.random() - 0.5) * 0.7;
  roadCurve += (targetCurve - roadCurve) * 0.02;

  // Tire wear
  player.tire -= 0.01;
  if (player.tire < 0) player.tire = 0;

  // Grip
  let grip = 0.85 * (player.tire / 100);
  if (rain) grip *= 0.75;
  if (keys[" "]) grip *= 0.9;

  // Speed
  let maxSpeed = BASE_MAX_SPEED * (1 - player.damage / 150);
  if (keys["ArrowUp"]) player.speed += 0.12;
  if (keys["ArrowDown"]) player.speed -= 0.25;

  // DRS
  player.drs = keys["d"] || keys["D"];
  if (player.drs && player.speed > 5) maxSpeed += 1.5;

  player.speed *= 0.99;
  player.speed = Math.max(0, Math.min(player.speed, maxSpeed));

  // Steering
  if (keys["ArrowLeft"]) player.vx -= 0.5;
  if (keys["ArrowRight"]) player.vx += 0.5;
  player.vx *= grip;

  player.x += player.vx;
  player.angle = player.vx * 0.04;
  player.x -= roadCurve * player.speed * 18;

  // Damage from edges
  if (Math.abs(player.x) > 280) {
    player.damage += 0.1;
    player.speed *= 0.95;
  }

  // Pit lane
  player.inPit = player.x > 240 && player.speed < 2;
  if (player.inPit) {
    player.tire += 0.5;
    player.damage -= 0.5;
    if (player.tire > 100) player.tire = 100;
    if (player.damage < 0) player.damage = 0;
  }

  player.dist += player.speed;

  // AI
  aiCars.forEach(ai => {
    ai.dist += ai.speed;
    ai.lane -= roadCurve * ai.speed * 8;
  });

  // Finish
  if (player.dist >= TRACK_LENGTH) raceOver = true;
}

// ================= DRAW CAR =================
function drawF1Car(x, y, s, a, c) {
  ctx.save();
  ctx.translate(x, y);
  ctx.rotate(a);
  ctx.scale(s, s);

  ctx.fillStyle = c;
  ctx.fillRect(-12, -35, 24, 70);
  ctx.fillRect(-6, -55, 12, 20);
  ctx.fillRect(-22, 30, 44, 8);

  ctx.fillStyle = "black";
  ctx.fillRect(-20, -20, 8, 16);
  ctx.fillRect(12, -20, 8, 16);
  ctx.fillRect(-20, 5, 8, 16);
  ctx.fillRect(12, 5, 8, 16);

  ctx.restore();
}

// ================= DRAW =================
function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // Road
  ctx.fillStyle = "#555";
  ctx.beginPath();
  ctx.moveTo(180 + roadCurve * 300, 500);
  ctx.lineTo(350 + roadCurve * 120, 200);
  ctx.lineTo(550 + roadCurve * 120, 200);
  ctx.lineTo(720 + roadCurve * 300, 500);
  ctx.closePath();
  ctx.fill();

  // Pit lane
  ctx.fillStyle = "#333";
  ctx.fillRect(650, 200, 80, 300);

  // AI cars
  aiCars.forEach(ai => {
    const z = ai.dist - player.dist;
    if (z < -100 || z > 900) return;
    const s = 1 - z / 1100;
    drawF1Car(450 + ai.lane * s, 280 + z * 0.45, s, 0, ai.color);
  });

  // Player
  drawF1Car(450 + player.x, 420, 1, player.angle, "red");

  // Night overlay
  if (night) {
    ctx.fillStyle = "rgba(0,0,50,0.35)";
    ctx.fillRect(0, 0, canvas.width, canvas.height);
  }

  // Rain
  if (rain) {
    ctx.strokeStyle = "rgba(200,200,255,0.3)";
    for (let i = 0; i < 50; i++)
      ctx.strokeRect(Math.random()*900, Math.random()*500, 2, 10);
  }

  // HUD
  ctx.fillStyle = "white";
  ctx.fillText(`Distance: ${Math.floor(player.dist)} / ${TRACK_LENGTH}`, 20, 25);
  ctx.fillText(`Tire: ${player.tire.toFixed(0)}%`, 20, 45);
  ctx.fillText(`Damage: ${player.damage.toFixed(0)}%`, 20, 65);
  ctx.fillText(`Position: ${1 + aiCars.filter(a => a.dist > player.dist).length}/5`, 20, 85);

  if (!raceStarted) {
    ctx.font = "80px Arial";
    ctx.fillText(countdown > 120 ? "3" : countdown > 60 ? "2" : "1", 430, 250);
  }

  if (raceOver) {
    ctx.fillStyle = "black";
    ctx.fillRect(200, 150, 520, 200);
    ctx.fillStyle = "white";
    ctx.font = "28px Arial";
    ctx.fillText("ðŸŽ‰ HAPPY NEW YEAR 2026!!! ðŸŽ‰", 245, 260);
  }
}

// ================= LOOP =================
function loop() {
  update();
  draw();
  requestAnimationFrame(loop);
}
loop();
</script>

</body>
</html>
