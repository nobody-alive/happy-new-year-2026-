<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>F1 1km Drift Race</title>
<style>
  body {
    margin: 0;
    background: #111;
    color: white;
    font-family: Arial, sans-serif;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
  }
  canvas {
    background: #444;
    border: 4px solid white;
  }
</style>
</head>
<body>

<canvas id="game" width="900" height="500"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

const TRACK_LENGTH = 1000;
let raceOver = false;
let finishOrder = [];

// ---------- INPUT ----------
const keys = {};
document.addEventListener("keydown", e => keys[e.key] = true);
document.addEventListener("keyup", e => keys[e.key] = false);

// ---------- CARS ----------
const cars = [
  { name: "YOU", x: 150, y: 100, vx: 0, speed: 0, dist: 0, color: "red", ai: false },
  { name: "AI 1", x: 300, y: 180, speed: 4.6, dist: 0, color: "blue", ai: true },
  { name: "AI 2", x: 450, y: 260, speed: 4.3, dist: 0, color: "green", ai: true },
  { name: "AI 3", x: 600, y: 340, speed: 4.1, dist: 0, color: "yellow", ai: true },
  { name: "AI 4", x: 750, y: 420, speed: 3.9, dist: 0, color: "orange", ai: true }
];

// ---------- UPDATE ----------
function update() {
  if (raceOver) return;

  cars.forEach(car => {
    if (car.ai) {
      car.dist += car.speed;
    } else {
      // ACCEL / BRAKE
      if (keys["ArrowUp"]) car.speed += 0.15;
      if (keys["ArrowDown"]) car.speed -= 0.25;
      car.speed *= 0.985;
      car.speed = Math.max(0, Math.min(car.speed, 6.5));

      // DRIFT
      const drifting = keys[" "];
      const grip = drifting ? 0.92 : 0.75;
      const steerPower = drifting ? 0.45 : 0.3;

      if (keys["ArrowLeft"]) car.vx -= steerPower * car.speed;
      if (keys["ArrowRight"]) car.vx += steerPower * car.speed;

      car.vx *= grip;
      car.x += car.vx;

      // ROAD LIMITS
      car.x = Math.max(60, Math.min(canvas.width - 60, car.x));

      car.dist += car.speed;
    }

    // FINISH
    if (car.dist >= TRACK_LENGTH && !finishOrder.includes(car)) {
      finishOrder.push(car);
      if (car.name === "YOU") raceOver = true;
    }
  });
}

// ---------- DRAW ----------
function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // Road
  ctx.fillStyle = "#222";
  ctx.fillRect(0, 50, canvas.width, canvas.height - 100);

  // Finish Line
  ctx.fillStyle = "white";
  ctx.fillRect(canvas.width - 60, 50, 10, canvas.height - 100);

  // Cars
  cars.forEach(car => {
    ctx.save();
    ctx.translate(car.x, car.y);
    ctx.rotate(car.vx * 0.05); // visual drift angle
    ctx.fillStyle = car.color;
    ctx.fillRect(-20, -10, 40, 20);
    ctx.restore();
  });

  // HUD
  ctx.fillStyle = "white";
  ctx.font = "18px Arial";
  ctx.fillText(
    "Distance: " + Math.min(Math.floor(cars[0].dist), TRACK_LENGTH) + " / 1000 m",
    20, 30
  );
  ctx.fillText("Hold SPACE to DRIFT", 20, 55);

  // FINISH MESSAGE
  if (raceOver) {
    const pos = finishOrder.findIndex(c => c.name === "YOU") + 1;

    ctx.fillStyle = "black";
    ctx.fillRect(200, 150, 520, 210);

    ctx.fillStyle = "white";
    ctx.font = "30px Arial";
    ctx.fillText(`You finished ${pos}${suffix(pos)}!`, 310, 225);
    ctx.font = "28px Arial";
    ctx.fillText("ðŸŽ‰ HAPPY NEW YEAR 2026!!! ðŸŽ‰", 245, 275);
  }
}

function suffix(n) {
  return n === 1 ? "st" : n === 2 ? "nd" : n === 3 ? "rd" : "th";
}

// ---------- LOOP ----------
function loop() {
  update();
  draw();
  requestAnimationFrame(loop);
}

loop();
</script>

</body>
</html>
